#include <opencv2/opencv.hpp>
#include <opencv2/tracking.hpp>

int main() {
    cv::VideoCapture cap("video.mp4");
    if (!cap.isOpened()) return -1;

    cv::Mat frame;
    cap.read(frame);

    // Initialize tracker
    cv::Rect2d roi = cv::selectROI("Tracker", frame);
    cv::Ptr<cv::Tracker> tracker = cv::TrackerCSRT::create();
    tracker->init(frame, roi);

    while (cap.read(frame)) {
        if (tracker->update(frame, roi)) {
            // Crop ROI region from frame
            cv::Mat roiImg = frame(roi).clone();

            // Preprocess (convert to gray + threshold)
            cv::Mat gray, mask;
            cv::cvtColor(roiImg, gray, cv::COLOR_BGR2GRAY);
            cv::threshold(gray, mask, 0, 255, cv::THRESH_BINARY | cv::THRESH_OTSU);

            // Find contours
            std::vector<std::vector<cv::Point>> contours;
            cv::findContours(mask, contours, cv::RETR_EXTERNAL, cv::CHAIN_APPROX_SIMPLE);

            if (!contours.empty()) {
                // Take largest contour
                size_t maxIdx = 0;
                double maxArea = 0;
                for (size_t i = 0; i < contours.size(); i++) {
                    double area = cv::contourArea(contours[i]);
                    if (area > maxArea) { maxArea = area; maxIdx = i; }
                }

                // Get bounding box of largest contour
                cv::Rect refinedBox = cv::boundingRect(contours[maxIdx]);

                // Shift back to full-frame coordinates
                refinedBox.x += roi.x;
                refinedBox.y += roi.y;

                // Update ROI
                roi = refinedBox;
            }

            // Draw refined ROI
            cv::rectangle(frame, roi, cv::Scalar(0, 255, 0), 2);
        }

        cv::imshow("Tracking", frame);
        if (cv::waitKey(30) == 27) break;
    }
    return 0;
}


Mình đã cập nhật mã để:

1. Gửi góc motor qua RESTful POST bằng QNetworkAccessManager.


2. Cho phép khởi tạo bounding-box thủ công bằng chuột trên frame hiển thị.



Bạn có muốn mình viết thêm đoạn server REST giả lập (vd: bằng Python Flask hoặc QtHttpServer) để test giao tiếp motor không?

