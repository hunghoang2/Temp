#include <iostream>
#include <fstream>
#include <sstream>
#include <string>
#include <regex>

void replaceJsonFields(const std::string& filePath,
                       double newLat, double newLon, double newAlt)
{
    // Đọc toàn bộ file vào string
    std::ifstream file(filePath);
    if (!file.is_open()) {
        std::cerr << "Không thể mở file " << filePath << std::endl;
        return;
    }

    std::ostringstream buffer;
    buffer << file.rdbuf();
    std::string content = buffer.str();
    file.close();

    // Regex: thay giá trị của latitude
    content = std::regex_replace(
        content,
        std::regex(R"("latitude"\s*:\s*[-+]?\d*\.?\d+)"),
        "\"latitude\": " + std::to_string(newLat)
    );

    // Regex: thay giá trị của longitude
    content = std::regex_replace(
        content,
        std::regex(R"("longitude"\s*:\s*[-+]?\d*\.?\d+)"),
        "\"longitude\": " + std::to_string(newLon)
    );

    // Regex: thay giá trị của altitude
    content = std::regex_replace(
        content,
        std::regex(R"("altitude"\s*:\s*[-+]?\d*\.?\d+)"),
        "\"altitude\": " + std::to_string(newAlt)
    );

    // Ghi lại file (giữ nguyên format, chỉ thay giá trị)
    std::ofstream out(filePath, std::ios::trunc);
    if (!out.is_open()) {
        std::cerr << "Không thể ghi file " << filePath << std::endl;
        return;
    }
    out << content;
    out.close();

    std::cout << "✅ Đã cập nhật latitude, longitude, altitude trong " << filePath << std::endl;
}

int main() {
    replaceJsonFields("data.json", 106.999, 22.1234, 15.5);
    return 0;
}
