#!/usr/bin/env python3
import revpimodio2
from flask import Flask, jsonify

# Khởi tạo RevPi, autorefresh để thư viện tự cập nhật giá trị IO
rpi = revpimodio2.RevPiModIO(autorefresh=True)

app = Flask(__name__)

@app.route("/api/analog/4", methods=["GET"])
def get_analog_input_4():
    """
    Trả về giá trị của kênh AnalogInput_4 dạng JSON
    """
    try:
        value = rpi.io.AnalogInput_4.value     # đọc raw value
        # Nếu bạn có scale sang Volt hoặc mA thì tính thêm ở đây
        return jsonify({
            "channel": "AnalogInput_4",
            "value": value
        })
    except AttributeError:
        # Trường hợp PiCtory không có tên IO này
        return jsonify({
            "error": "IO 'AnalogInput_4' không tồn tại. Kiểm tra lại tên trong PiCtory."
        }), 500


if __name__ == "__main__":
    # Chạy API trên mọi interface, port 5000
    app.run(host="0.0.0.0", port=5000)
