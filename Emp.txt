cv::Mat processThermal(const cv::Mat& rgbFrame)
{
    static double smoothMin = 0, smoothMax = 255;
    const double alpha = 0.05;

    cv::Mat gray;
    cv::cvtColor(rgbFrame, gray, cv::COLOR_BGR2GRAY);

    double curMin, curMax;
    cv::minMaxLoc(gray, &curMin, &curMax);

    smoothMin = (1 - alpha) * smoothMin + alpha * curMin;
    smoothMax = (1 - alpha) * smoothMax + alpha * curMax;

    cv::Mat norm;
    gray.convertTo(norm, CV_8U, 255.0/(smoothMax - smoothMin),
                   -smoothMin * 255.0/(smoothMax - smoothMin));

    cv::bitwise_not(norm, norm);

    cv::Mat colored;
    cv::applyColorMap(norm, colored, cv::COLORMAP_INFERNO);

    return colored;
}
