#include <iostream>
#include <fstream>
#include <sstream>
#include <regex>

void overwriteLocationText(const std::string& filename,
                          double latitude,
                          double longitude,
                          double altitude) {
    std::ifstream in(filename);
    if (!in.is_open()) {
        std::cerr << "Không mở được file " << filename << "\n";
        return;
    }
    std::stringstream buffer;
    buffer << in.rdbuf();
    std::string content = buffer.str();
    in.close();

    // Regex tìm block "Location": { ... }
    std::regex locationRegex(R"("Location"\s*:\s*\{[^}]*\})");

    // Tạo block Location mới
    std::ostringstream oss;
    oss << "\"Location\": {\n"
        << "        \"latitude\": " << latitude << ",\n"
        << "        \"longitude\": " << longitude << ",\n"
        << "        \"altitude\": " << altitude << "\n"
        << "    }";

    // Thay thế block Location cũ bằng mới
    std::string replaced = std::regex_replace(content, locationRegex, oss.str());

    // Ghi lại file
    std::ofstream out(filename);
    if (!out.is_open()) {
        std::cerr << "Không ghi được file " << filename << "\n";
        return;
    }
    out << replaced;
    out.close();

    std::cout << "Đã cập nhật Location, giữ nguyên thứ tự trường!\n";
}

int main() {
    // Ví dụ gọi hàm:
    overwriteLocationText("app.json", 105.888, 21.333, 11.0);
    return 0;
}
