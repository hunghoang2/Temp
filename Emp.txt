#include <QCoreApplication>
#include "ZmqClientQt.h"

int main(int argc, char *argv[])
{
    QCoreApplication app(argc, argv);

    ZmqClientQt client("192.168.0.100", 5000);

    QObject::connect(&client, &ZmqClientQt::connected, [](){
        qDebug() << "[App] Connected to server";
    });
    QObject::connect(&client, &ZmqClientQt::reconnecting, [](){
        qDebug() << "[App] Reconnecting...";
    });
    QObject::connect(&client, &ZmqClientQt::disconnected, [](){
        qDebug() << "[App] Disconnected";
    });
    QObject::connect(&client, &ZmqClientQt::messageReceived, [](const QString& msg){
        qDebug() << "[App] Got reply:" << msg;
    });
    QObject::connect(&client, &ZmqClientQt::errorOccurred, [](const QString& err){
        qWarning() << "[App] Error:" << err;
    });

    client.start();

    // Gửi dữ liệu 10 ms/lần
    QTimer timer;
    QObject::connect(&timer, &QTimer::timeout, [&client](){
        static int count = 0;
        client.sendMessage(QString("DATA %1").arg(count++));
    });
    timer.start(10);

    return app.exec();
}
